<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"
      integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"
      integrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoeqMV/TJlSKda6FXzoEyYGjTe+vXA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <link rel="stylesheet" href="style.css" />
    <title>Interswitch Valentine</title>

    <!--[if IE]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <style></style>
  </head>
  <body>
    <div class="background new">
      <!-- Form Upload Input Section -->

      <div class="form">
        <form action="" name="upload-form">
          <div class="input--field">
            <label for="">Write Something for That Special Someone</label>
            <textarea
              name=""
              id="textUpdate"
              cols="30"
              rows="10"
              maxlength="100"
              onkeyup="charCount(this)"
            ></textarea>
            <p><span id="textcount">100</span>/100</p>
          </div>
        </form>
      </div>

      <!-- Image Upload Display -->
      <div class="image-upload">
        <div id="test-box">
          <div class="image">
            <img src="assets/TYCard All (1).png" alt="" />
          </div>
          <div class="details-container">
            <div class="details--inner">
              <div class="details">
                <p class="input--text"></p>
              </div>
            </div>
          </div>
        </div>
        <div class="button--container">
          <button id="download" class="download">Download</button>
        </div>
      </div>
    </div>

    <script>
      function charCount(textarea) {
        let max = 100;
        let length = textarea.value.length;
        if (length > max) {
          textarea.value = textarea.value.substring(0, 100);
        } else {
          let textCount = document.getElementById("textcount");
          textCount.innerText = max - length;
        }

        let textUpdate = document.getElementById("textUpdate").value;
        // let newString = textUpdate.replace(/(\r\n|\n|\r)/gm, "");
        let specialText = document.querySelector(".input--text");

        specialText.innerText = textUpdate;
      }

      document
        .getElementById("download")
        .addEventListener("click", function () {
          // let fullName = document.getElementById("nameInput").value;
          html2canvas(document.getElementById("test-box"), {
            allowTaint: true,
            useCORS: true,
          }).then(function (canvas) {
            var anchorTag = document.createElement("a");
            document.body.appendChild(anchorTag);
            // document.getElementById("previewImg").appendChild(canvas);
            anchorTag.download = `valentine.jpg`;
            anchorTag.href = canvas.toDataURL();
            anchorTag.target = "_blank";
            anchorTag.click();
          });
        });
    </script>
  </body>
</html>
